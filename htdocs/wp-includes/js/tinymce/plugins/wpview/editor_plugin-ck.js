!function(){var e,t=tinymce.VK,n=tinymce.dom.TreeWalker;tinymce.create("tinymce.plugins.wpView",{init:function(r){var i=this;"undefined"!=typeof wp&&wp.mce&&(r.onPreInit.add(function(e){e.schema.addValidElements("div[*],span[*]")}),r.onBeforeSetContent.add(function(e,t){t.content&&(t.content=wp.mce.view.toViews(t.content))}),r.onSetContent.add(function(e){wp.mce.view.render(e.getDoc())}),r.onInit.add(function(e){e.selection.onBeforeSetContent.add(function(t){var r,s,o=i.getParentView(t.getNode());o&&(!o.nextSibling||i.isView(o.nextSibling)?(s=e.getDoc().createTextNode(""),e.dom.insertAfter(s,o)):(r=new n(o.nextSibling,o.nextSibling),s=r.next()),t.select(s),t.collapse(!0))}),e.selection.onSetContent.add(function(e,t){if(t.context){var n=e.getNode();n.innerHTML&&(n.innerHTML=wp.mce.view.toViews(n.innerHTML),wp.mce.view.render(n))}})}),r.onPostProcess.add(function(e,t){(t.get||t.save)&&t.content&&(t.content=wp.mce.view.toText(t.content))}),r.onNodeChange.addToTop(function(e,t,n){var r=i.getParentView(n);return r?(i.select(r),!1):(i.deselect(),void 0)}),r.onKeyDown.addToTop(function(n,r){var s,o,u=r.keyCode;if(e){if(s=i.getParentView(n.selection.getNode()),s!==e)return i.deselect(),void 0;(u===t.DELETE||u===t.BACKSPACE)&&(o=wp.mce.view.instance(e))&&(o.remove(),i.deselect()),r.metaKey||r.ctrlKey||u>=112&&123>=u||r.preventDefault()}}))},getParentView:function(e){for(;e;){if(this.isView(e))return e;e=e.parentNode}},isView:function(e){return/(?:^|\s)wp-view-wrap(?:\s|$)/.test(e.className)},select:function(t){t!==e&&(this.deselect(),e=t,wp.mce.view.select(e))},deselect:function(){e&&wp.mce.view.deselect(e),e=null},getInfo:function(){return{longname:"WordPress Views",author:"WordPress",authorurl:"http://wordpress.org",infourl:"http://wordpress.org",version:"1.0"}}}),tinymce.PluginManager.add("wpview",tinymce.plugins.wpView)}();